<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>PICC æ–½æ‰“å›å ±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans TC", Arial, sans-serif;
      background: #f5f7fa;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 24px;
    }

    .card {
      background: #fff;
      padding: 28px;
      border-radius: 14px;
      width: 100%;
      max-width: 520px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    }

    h2 {
      margin: 0 0 16px;
      font-size: 22px;
    }

    .hint {
      font-size: 13px;
      color: #64748b;
      margin-bottom: 18px;
      line-height: 1.5;
    }

    .row {
      margin-bottom: 14px;
    }

    label {
      display: block;
      font-size: 13px;
      color: #334155;
      margin-bottom: 6px;
      font-weight: 600;
    }

    input, select, textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 12px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      font-size: 14px;
      outline: none;
      background: #fff;
    }

    input:focus, select:focus, textarea:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.12);
    }

    textarea {
      min-height: 90px;
      resize: vertical;
    }

    .grid2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .taskbox {
      background: #f1f5f9;
      border: 1px dashed #cbd5e1;
      border-radius: 12px;
      padding: 12px;
      margin: 12px 0 18px;
    }
    .taskbox .k { font-size: 12px; color: #64748b; }
    .taskbox .v { font-weight: 800; margin-top: 4px; word-break: break-all; }

    .btn {
      width: 100%;
      padding: 14px 16px;
      font-size: 15px;
      background: #2563eb;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
    }

    .btn:disabled { background: #94a3b8; cursor: not-allowed; }

    .btn2 {
      width: 100%;
      margin-top: 10px;
      padding: 12px 16px;
      font-size: 14px;
      background: #0f172a;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      opacity: .9;
    }

    .danger {
      color: #b91c1c;
      font-size: 13px;
      margin-top: 10px;
      display: none;
    }

    .ok {
      margin-top: 12px;
      font-size: 13px;
      color: #16a34a;
      display: none;
    }
  </style>
</head>

<body>
  <div class="card">
    <h2>ğŸ“Œ PICC æ–½æ‰“å›å ±</h2>
    <div class="hint">
      é€™é æœƒæŠŠå›å ±è³‡æ–™é€åˆ° n8nï¼Œç„¶å¾Œç”± n8n å¯«å…¥ Google Sheetã€‚<br/>
      è‹¥æ²’æœ‰å¸¶å…¥ taskIdï¼Œä»£è¡¨ä½ æ˜¯ç›´æ¥é–‹é€™é ï¼Œè«‹å›åˆ°ã€Œå¾…æ–½æ‰“æ¸…å–®ã€å†é»é€²ä¾†ã€‚
    </div>

    <div class="taskbox">
      <div class="k">ä»»å‹™ç·¨è™Ÿï¼ˆtaskIdï¼‰</div>
      <div class="v" id="taskIdText">â€”</div>
    </div>

    <!-- âœ… æœ€ç©©ï¼šç”¨ FORM POSTï¼ˆé¿é–‹ CORSï¼‰ -->
    <form id="reportForm" method="POST" action="https://chihwei.app.n8n.cloud/webhook/picc/report-done">
      <!-- taskIdï¼šä¸€å®šè¦é€ -->
      <input type="hidden" name="taskId" id="taskIdInput" />

      <div class="grid2">
        <div class="row">
          <label for="operator">æ–½æ‰“äººï¼ˆå¿…å¡«ï¼‰</label>
          <input id="operator" name="operator" placeholder="ä¾‹ï¼šå¼µå¿—ç¶­ / NP Aç­" required />
        </div>

        <div class="row">
          <label for="site">æ–½æ‰“ä½ç½®ï¼ˆå¿…å¡«ï¼‰</label>
          <select id="site" name="site" required>
            <option value="">è«‹é¸æ“‡</option>
            <option value="RUA">å³ä¸Šè‚¢ RUA</option>
            <option value="LUA">å·¦ä¸Šè‚¢ LUA</option>
            <option value="Other">å…¶ä»–</option>
          </select>
        </div>
      </div>

      <div class="grid2">
        <div class="row">
          <label for="catheterLength">ç®¡è·¯é•·åº¦ï¼ˆcmï¼‰</label>
          <input id="catheterLength" name="catheterLength" type="number" step="0.1" placeholder="ä¾‹ï¼š42.5" />
        </div>

        <div class="row">
          <label for="vein">è¡€ç®¡ï¼ˆå¯é¸ï¼‰</label>
          <select id="vein" name="vein">
            <option value="">ä¸å¡«</option>
            <option value="Basilic">Basilicï¼ˆè²´è¦éœè„ˆï¼‰</option>
            <option value="Brachial">Brachialï¼ˆè‚±éœè„ˆï¼‰</option>
            <option value="Cephalic">Cephalicï¼ˆé ­éœè„ˆï¼‰</option>
            <option value="Other">å…¶ä»–</option>
          </select>
        </div>
      </div>

      <div class="row">
        <label for="note">å‚™è¨»ï¼ˆå¯é¸ï¼‰</label>
        <textarea id="note" name="note" placeholder="ä¾‹ï¼šä¸€æ¬¡æˆåŠŸ/å›°é›£é»/æ˜¯å¦æœ‰ä½µç™¼ç—‡/æ˜¯å¦æ‹ç‰‡ç¢ºèªç­‰"></textarea>
      </div>

      <!-- ä½ ä¹Ÿå¯ä»¥è®“ n8n ç›´æ¥å¯«æ­»ç‹€æ…‹ç‚º å®Œæˆï¼Œä¸ä¸€å®šè¦é€ -->
      <input type="hidden" name="status" value="å®Œæˆ" />

      <button class="btn" type="submit" id="submitBtn">é€å‡ºå›å ±</button>

      <div class="danger" id="errBox">âŒ æ‰¾ä¸åˆ° taskIdï¼Œç„¡æ³•é€å‡ºã€‚è«‹å›åˆ°å¾…æ–½æ‰“æ¸…å–®é»é€²ä¾†ã€‚</div>
      <div class="ok" id="okBox">âœ… å·²é€å‡ºï¼ˆè‹¥ n8n æœ‰è¨­å®šå›æ‡‰é ï¼Œå¯åœ¨æ­¤é¡¯ç¤ºå›æ‡‰ï¼‰ã€‚</div>
    </form>

    <!-- å›åˆ°æ¸…å–®ï¼ˆå¯é¸ï¼‰ -->
    <button class="btn2" type="button" id="backBtn">å›åˆ°å¾…æ–½æ‰“æ¸…å–®</button>
  </div>

  <script>
    /* =========================
       ä¾ä½ çš„å¯¦éš›æ¸…å–®é  URL èª¿æ•´
    ========================= */
    const PENDING_LIST_URL = "https://luckyseal0923.github.io/picc-report-ui/list.html";

    /* =========================
       è®€å– taskId
    ========================= */
    const params = new URLSearchParams(window.location.search);
    const taskId = params.get("taskId");

    const taskIdText = document.getElementById("taskIdText");
    const taskIdInput = document.getElementById("taskIdInput");
    const errBox = document.getElementById("errBox");
    const submitBtn = document.getElementById("submitBtn");

    taskIdText.textContent = taskId || "æœªå¸¶å…¥ taskId";
    taskIdInput.value = taskId || "";

    if (!taskId) {
      errBox.style.display = "block";
      submitBtn.disabled = true;
    }

    /* =========================
       å›åˆ°æ¸…å–®
    ========================= */
    document.getElementById("backBtn").onclick = () => {
      window.location.href = PENDING_LIST_URL;
    };

    /* =========================
       é˜²å‘†ï¼šé€å‡ºå‰å†æª¢æŸ¥ä¸€æ¬¡
    ========================= */
    document.getElementById("reportForm").addEventListener("submit", (e) => {
      if (!taskIdInput.value) {
        e.preventDefault();
        errBox.style.display = "block";
        submitBtn.disabled = true;
        return;
      }
      // é€å‡ºå¾Œå¯ä»¥å…ˆé–ä½æŒ‰éˆ•é¿å…é€£é»
      submitBtn.disabled = true;
      submitBtn.textContent = "é€å‡ºä¸­â€¦";
    });
  </script>
</body>
</html>
