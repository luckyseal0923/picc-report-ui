<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>PICC ä»»å‹™ç®¡ç†ï¼ˆå®‰å…¨ç·¨è¼¯ï¼‰</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", Arial, sans-serif;
  background: #f6f7f9;
  padding: 20px;
}
h2 {
  margin-bottom: 12px;
}
table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}
th {
  background: #f0f0f0;
}
input, select {
  width: 90%;
  padding: 4px;
}
button {
  padding: 4px 10px;
  cursor: pointer;
}
</style>
</head>

<body>

<h2>ğŸ“‹ PICC ä»»å‹™ç®¡ç†ï¼ˆå®‰å…¨ç·¨è¼¯ï¼‰</h2>

<table id="taskTable">
  <thead>
    <tr>
      <th>ä»»å‹™ç·¨è™Ÿ</th>
      <th>ç—…äºº</th>
      <th>åºŠè™Ÿ</th>
      <th>MRN</th>
      <th>ç‹€æ…‹</th>
      <th>å›°é›£åº¦</th>
      <th>å‚™è¨»</th>
      <th>å„²å­˜</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const API_LIST   = "https://chihwei-n8n.zeabur.app/webhook/admin/tasks";
const API_UPDATE = "https://chihwei-n8n.zeabur.app/webhook/admin/update-task";

/* =========================
   è¼‰å…¥ä»»å‹™æ¸…å–®
========================= */
fetch(API_LIST)
  .then(res => res.json())
  .then(data => {
    const tbody = document.querySelector("#taskTable tbody");
    tbody.innerHTML = "";

    data.forEach(row => {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${row.task_id}</td>
        <td>${row.patient_name}</td>
        <td>
          <input class="bed_no" value="${row.bed_no ?? ''}">
        </td>
        <td>${row.mrn}</td>
        <td>${row.status}</td>
        <td>
          <select class="difficulty">
            <option value="ä¸€èˆ¬" ${row.difficulty === 'ä¸€èˆ¬' ? 'selected' : ''}>ä¸€èˆ¬</option>
            <option value="å›°é›£" ${row.difficulty === 'å›°é›£' ? 'selected' : ''}>å›°é›£</option>
          </select>
        </td>
        <td>
          <input class="remark" value="${row.remark ?? ''}">
        </td>
        <td>
          <button onclick="saveRow(this, '${row.task_id}')">ğŸ’¾</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  })
  .catch(err => {
    alert("è¼‰å…¥è³‡æ–™å¤±æ•—");
    console.error(err);
  });

/* =========================
   å„²å­˜å–®ç­†
========================= */
function saveRow(btn, taskId) {
  const tr = btn.closest("tr");

  const payload = {
    task_id: taskId,
    bed_no: tr.querySelector(".bed_no").value,
    difficulty: tr.querySelector(".difficulty").value,
    remark: tr.querySelector(".remark").value
  };

  fetch(API_UPDATE, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(() => {
    alert("å·²å„²å­˜");
  })
  .catch(err => {
    alert("å„²å­˜å¤±æ•—");
    console.error(err);
  });
}
</script>

</body>
</html>
