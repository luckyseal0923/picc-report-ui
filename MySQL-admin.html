<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>PICC ä»»å‹™ç®¡ç†ï¼ˆå®‰å…¨ç·¨è¼¯ï¼‰</title>

<style>
body {
  font-family: Arial, "Noto Sans TC", sans-serif;
  background: #f6f7f9;
  padding: 20px;
}

h2 {
  margin-bottom: 12px;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}

th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}

th {
  background: #eee;
}

input, select {
  width: 90%;
  padding: 4px;
}

button {
  padding: 4px 10px;
  cursor: pointer;
}
</style>
</head>

<body>

<h2>ğŸ“‹ PICC ä»»å‹™ç®¡ç†ï¼ˆå®‰å…¨ç·¨è¼¯ï¼‰</h2>

<table id="taskTable">
  <thead>
    <tr>
      <th>ä»»å‹™ç·¨è™Ÿ</th>
      <th>ç—…äºº</th>
      <th>åºŠè™Ÿ</th>
      <th>MRN</th>
      <th>ç‹€æ…‹</th>
      <th>å›°é›£åº¦</th>
      <th>å‚™è¨»</th>
      <th>å„²å­˜</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const API_LIST   = "https://chihwei-n8n.zeabur.app/webhook/admin/tasks";
const API_UPDATE = "https://chihwei-n8n.zeabur.app/webhook/admin/update-task";

fetch(API_LIST)
  .then(res => res.json())
  .then(res => {
    const tbody = document.querySelector("#taskTable tbody");
    tbody.innerHTML = "";

    if (!res.data || !Array.isArray(res.data)) {
      alert("API å›å‚³æ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ n8n");
      return;
    }

    res.data.forEach(item => {
      const row = item.json;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.task_id}</td>
        <td>${row.patient_name}</td>
        <td><input value="${row.bed_no || ''}"></td>
        <td>${row.mrn}</td>
        <td>${row.status}</td>
        <td>
          <select>
            <option value="ä¸€èˆ¬" ${row.difficulty === 'ä¸€èˆ¬' ? 'selected' : ''}>ä¸€èˆ¬</option>
            <option value="å›°é›£" ${row.difficulty === 'å›°é›£' ? 'selected' : ''}>å›°é›£</option>
          </select>
        </td>
        <td><input value="${row.remark || ''}"></td>
        <td>
          <button onclick="saveRow(this, '${row.task_id}')">ğŸ’¾</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  })
  .catch(err => {
    console.error(err);
    alert("è®€å–è³‡æ–™å¤±æ•—");
  });

function saveRow(btn, taskId) {
  const tr = btn.closest("tr");
  const inputs = tr.querySelectorAll("input, select");

  const payload = {
    task_id: taskId,
    bed_no: inputs[0].value,
    difficulty: inputs[1].value,
    remark: inputs[2].value
  };

  fetch(API_UPDATE, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(() => alert("å·²å„²å­˜"))
  .catch(() => alert("å„²å­˜å¤±æ•—"));
}
</script>

</body>
</html>
