<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PICC å¾…æ–½æ‰“æ¸…å–®</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial, sans-serif;
      background: #f6f7f9;
      margin: 0;
      padding: 16px;
    }
    h1 {
      font-size: 18px;
      margin-bottom: 12px;
    }
    .list {
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
    }
    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 14px;
      border-bottom: 1px solid #eef0f4;
    }
    .row:last-child {
      border-bottom: none;
    }
    .info {
      line-height: 1.4;
    }
    .bed {
      font-weight: 600;
    }
    .name {
      color: #333;
      font-size: 14px;
    }
    .claimer {
      font-size: 12px;
      color: #666;
    }
    button {
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      font-size: 13px;
      cursor: pointer;
    }
    .btn-active {
      background: #111;
      color: #fff;
    }
    .btn-disabled {
      background: #e5e7eb;
      color: #999;
      cursor: not-allowed;
    }
    .loading, .error {
      padding: 12px;
      font-size: 14px;
      color: #555;
    }
  </style>
</head>
<body>

<h1>ğŸ©º ç›®å‰å¾…æ–½æ‰“ PICC æ¸…å–®</h1>

<div id="content" class="list">
  <div class="loading">è¼‰å…¥ä¸­â€¦</div>
</div>

<script>
/* =========================
   è¨­å®šå€ï¼ˆåªè¦æ”¹é€™è£¡ï¼‰
   ========================= */

// ğŸ‘‰ n8nã€ŒæŸ¥è©¢å¾…æ–½æ‰“æ¸…å–®ã€Webhookï¼ˆGETï¼‰
const API_URL = "https://YOUR_N8N_LIST_API_URL_HERE";

// ğŸ‘‰ ä½ çš„å®Œæˆå›å ±è¡¨å–®é 
const REPORT_PAGE = "https://luckyseal0923.github.io/picc-report-ui/";

/* =========================
   å–å¾—ç›®å‰ä½¿ç”¨è€…ï¼ˆç¬¬ä¸€ç‰ˆç”¨ claimedBy åå­—ï¼‰
   ========================= */

const params = new URLSearchParams(window.location.search);
const currentUser = params.get("claimedBy");

/* =========================
   ä¸»ç¨‹å¼
   ========================= */

const content = document.getElementById("content");

if (!currentUser) {
  content.innerHTML = '<div class="error">âŒ ç¼ºå°‘ä½¿ç”¨è€…è³‡è¨Šï¼ˆclaimedByï¼‰</div>';
} else {
  fetch(API_URL)
    .then(res => res.json())
    .then(data => {
      if (!Array.isArray(data) || data.length === 0) {
        content.innerHTML = '<div class="loading">ç›®å‰æ²’æœ‰å¾…æ–½æ‰“ä»»å‹™</div>';
        return;
      }

      content.innerHTML = "";

      data.forEach(task => {
        const row = document.createElement("div");
        row.className = "row";

        const info = document.createElement("div");
        info.className = "info";
        info.innerHTML = `
          <div class="bed">åºŠè™Ÿï¼š${task.bedNo}</div>
          <div class="name">ç—…äººï¼š${task.name}</div>
          <div class="claimer">æ¥å–®è€…ï¼š${task.claimedBy}</div>
        `;

        const btn = document.createElement("button");

        if (task.claimedBy === currentUser) {
          btn.className = "btn-active";
          btn.textContent = "å¡«å¯«å®Œæˆå›å ±";
          btn.onclick = () => {
            const url =
              REPORT_PAGE +
              "?taskId=" + encodeURIComponent(task.taskId) +
              "&bedNo=" + encodeURIComponent(task.bedNo) +
              "&mrn=" + encodeURIComponent(task.mrn) +
              "&name=" + encodeURIComponent(task.name) +
              "&claimedBy=" + encodeURIComponent(task.claimedBy);
            window.location.href = url;
          };
        } else {
          btn.className = "btn-disabled";
          btn.textContent = "åƒ…ä¾›æŸ¥çœ‹";
          btn.disabled = true;
        }

        row.appendChild(info);
        row.appendChild(btn);
        content.appendChild(row);
      });
    })
    .catch(() => {
      content.innerHTML = '<div class="error">âŒ ç„¡æ³•è¼‰å…¥å¾…æ–½æ‰“æ¸…å–®</div>';
    });
}
</script>

</body>
</html>
