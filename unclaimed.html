<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>PICC å¾…é ç´„æ¸…å–®</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
               "Noto Sans TC", Arial, sans-serif;
  background: #fff7ed; /* æ·¡æ©˜èƒŒæ™¯ */
  margin: 0;
  padding: 20px;
}

h2 {
  margin: 0 0 8px;
  color: #c2410c;
}

.hint {
  font-size: 14px;
  color: #9a3412;
  margin-bottom: 16px;
}

.card {
  background: #ffffff;
  border-radius: 10px;
  padding: 16px;
  margin-bottom: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  display: flex;
  gap: 14px;
  align-items: stretch;
}

/* å·¦å´è­¦ç¤ºæ¢ */
.alert-bar {
  width: 6px;
  border-radius: 6px;
  background: #f97316;
}

/* å¡ç‰‡å…§å®¹ */
.content {
  flex: 1;
}

.name {
  font-size: 18px;
  font-weight: 800;
  margin-bottom: 6px;
  color: #7c2d12;
}

.meta {
  font-size: 14px;
  color: #92400e;
}

.waiting {
  margin-top: 6px;
  font-size: 14px;
  font-weight: 700;
  color: #b45309;
}

/* æ¥å–®æŒ‰éˆ• */
.claim-btn {
  align-self: center;
  padding: 10px 18px;
  border-radius: 999px;
  border: none;
  cursor: pointer;
  font-size: 15px;
  font-weight: 700;
  background: linear-gradient(135deg, #f97316, #fb923c);
  color: white;
}

.claim-btn:hover {
  opacity: 0.9;
}

.empty {
  color: #9a3412;
  font-size: 15px;
  padding: 12px 4px;
}

.error {
  color: #b91c1c;
  font-weight: 700;
  padding: 12px 4px;
}
</style>
</head>

<body>

<h2>âš ï¸ PICC å¾…é ç´„æ¸…å–®</h2>
<div class="hint">
  ä»¥ä¸‹æ¡ˆä»¶å°šæœªè¢«æ¥å–®ï¼Œè«‹ç¢ºèªç‹€æ³å¾Œå†èªé ˜ã€‚
</div>

<div id="msg"></div>
<div id="list"></div>

<script>
const API =
  "https://chihwei.app.n8n.cloud/webhook/picc/unclaimed-list";

function $(id){ return document.getElementById(id); }
function safe(v){ return v == null ? "" : String(v); }

function setMsg(cls, text) {
  const el = $("msg");
  el.className = cls || "";
  el.textContent = text || "";
}

async function loadList() {
  setMsg("", "");
  $("list").innerHTML = "";

  try {
    const res = await fetch(API, { cache: "no-store" });
    const raw = await res.text();

    if (!res.ok) throw new Error("HTTP " + res.status);

    if (!raw || raw.trim() === "") {
      setMsg("empty", "ğŸ“­ ç›®å‰æ²’æœ‰å¾…é ç´„æ¡ˆä»¶");
      return;
    }

    const data = JSON.parse(raw);
    if (!Array.isArray(data) || data.length === 0) {
      setMsg("empty", "ğŸ“­ ç›®å‰æ²’æœ‰å¾…é ç´„æ¡ˆä»¶");
      return;
    }

    data.forEach(item => {
      $("list").appendChild(renderCard(item));
    });

  } catch (e) {
    console.error(e);
    setMsg("error", "âŒ ç„¡æ³•è¼‰å…¥å¾…é ç´„æ¸…å–®");
  }
}

function renderCard(item) {
  const div = document.createElement("div");
  div.className = "card";

  const taskId = safe(item.taskId);
  const name = safe(item.name);
  const bedNo = safe(item.bedNo);
  const mrn = safe(item.mrn);
  const createdAt = safe(item.createdAt);

  div.innerHTML = `
    <div class="alert-bar"></div>
    <div class="content">
      <div class="name">${name || "ï¼ˆæœªå¡«å§“åï¼‰"}</div>
      <div class="meta">åºŠè™Ÿ ${bedNo} ï½œ ç—…æ­·è™Ÿ ${mrn}</div>
      ${createdAt ? `<div class="waiting">â± ç­‰å¾…ä¸­</div>` : ""}
    </div>
    <button class="claim-btn"
      onclick="claimTask('${taskId}')">
      æ¥å–®
    </button>
  `;

  return div;
}

function claimTask(taskId) {
  alert("ï¼ˆç¤ºæ„ï¼‰æ¥å–®ï¼š" + taskId);
}

loadList();
</script>

</body>
</html>
