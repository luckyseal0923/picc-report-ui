<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>PICC æ–½æ‰“å›å ±ï¼ˆè‡ªèµ·å–®ãƒ»è‡ªå›å ±ï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
        "Noto Sans TC", sans-serif;
      background: #f5f6f7;
      margin: 0;
      padding: 24px;
    }
    .card {
      max-width: 720px;
      margin: 0 auto 24px;
      background: #fff;
      padding: 24px;
      border-radius: 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    }
    h2 { margin: 0 0 12px; }
    .hint { font-size: 14px; color: #666; margin-bottom: 16px; }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    label { font-weight: 600; margin-bottom: 6px; display: block; }
    input, select, textarea {
      width: 100%;
      padding: 12px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    input[readonly] { background: #f1f3f5; }
    textarea { resize: vertical; min-height: 80px; }
    .full { grid-column: 1 / -1; }
    button {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      background: #ff7a45;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
    }
    button:disabled { background: #ccc; }
    .status { margin-top: 12px; text-align: center; }
    @media (max-width: 640px) {
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>

<div class="card">
  <h2>ğŸ“Œ PICC æ–½æ‰“å›å ±ï¼ˆè‡ªèµ·å–®ãƒ»è‡ªå›å ±ï¼‰</h2>
  <div class="hint">ä»¥ä¸‹ç—…äººè³‡æ–™ç”±èµ·å–®ç³»çµ±å¸¶å…¥ï¼Œåƒ…ä¾›ç¢ºèªï¼Œç„¡æ³•ä¿®æ”¹ã€‚</div>

  <div class="grid">
    <div>
      <label>ç—…äººå§“å</label>
      <input id="patientName" readonly />
    </div>
    <div>
      <label>åºŠè™Ÿ</label>
      <input id="bedNo" readonly />
    </div>
    <div class="full">
      <label>ç—…æ­·è™Ÿ</label>
      <input id="mrn" readonly />
    </div>
  </div>
</div>

<div class="card">
  <h2>ğŸ§¾ æ–½æ‰“å›å ±è³‡æ–™</h2>

  <div class="grid">
    <div>
      <label>æ–½æ‰“äºº</label>
      <input id="operator" />
    </div>
    <div>
      <label>æ”¾ç½®å›°é›£åº¦</label>
      <select id="difficulty">
        <option value="">è«‹é¸æ“‡</option>
        <option value="ç°¡å–®">ç°¡å–®</option>
        <option value="ä¸­ç­‰">ä¸­ç­‰</option>
        <option value="å›°é›£">å›°é›£</option>
      </select>
    </div>
    <div>
      <label>æ–½æ‰“ä½ç½®</label>
      <select id="insertionSite">
        <option value="">è«‹é¸æ“‡</option>
        <option value="å³ä¸Šè‡‚">å³ä¸Šè‡‚</option>
        <option value="å·¦ä¸Šè‡‚">å·¦ä¸Šè‡‚</option>
      </select>
    </div>
    <div>
      <label>è¡€ç®¡</label>
      <select id="vein">
        <option value="">è«‹é¸æ“‡</option>
        <option value="Basilic">Basilic</option>
        <option value="Cephalic">Cephalic</option>
      </select>
    </div>
    <div>
      <label>ç®¡è·¯é¡å‹</label>
      <select id="catheterType">
        <option value="">è«‹é¸æ“‡</option>
        <option value="å–®è…”">å–®è…”</option>
        <option value="é›™è…”">é›™è…”</option>
      </select>
    </div>
    <div>
      <label>ç®¡è·¯é•·åº¦ï¼ˆcmï¼‰</label>
      <input id="catheterLength" type="number" />
    </div>
    <div class="full">
      <label>å‚™è¨»</label>
      <textarea id="remark"></textarea>
    </div>
  </div>

  <button id="submitBtn" onclick="submitReport()">é€å‡ºæ–½æ‰“å›å ±</button>
  <div class="status" id="statusText"></div>
</div>

<script>
  /* === è®€å– URL åƒæ•¸ï¼ˆå”¯ä¸€ä¸€æ®µï¼‰=== */
  const params = new URLSearchParams(window.location.search);
  document.getElementById("patientName").value = params.get("name") || "";
  document.getElementById("bedNo").value = params.get("bedNo") || "";
  document.getElementById("mrn").value = params.get("mrn") || "";

  const WEBHOOK_URL = "https://ä½ çš„-n8n-domain/webhook/picc-self-report";

  async function submitReport() {
    const payload = {
      patientName: patientName.value,
      bedNo: bedNo.value,
      mrn: mrn.value,
      operator: operator.value,
      difficulty: difficulty.value,
      insertionSite: insertionSite.value,
      vein: vein.value,
      catheterType: catheterType.value,
      catheterLength: catheterLength.value,
      remark: remark.value,
      status: "å®Œæˆ",
      source: "self-report",
      completedAt: new Date().toISOString()
    };

    submitBtn.disabled = true;
    statusText.innerText = "é€å‡ºä¸­â€¦";

    try {
      await fetch(WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      statusText.innerText = "âœ… å·²å®Œæˆæ–½æ‰“å›å ±";
    } catch {
      statusText.innerText = "âŒ é€å‡ºå¤±æ•—";
      submitBtn.disabled = false;
    }
  }
</script>

</body>
</html>
