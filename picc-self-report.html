<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>PICC æ–½æ‰“å›å ±ï¼ˆè‡ªèµ·å–®ãƒ»è‡ªå›å ±ï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
        "Noto Sans TC", sans-serif;
      background: #f5f6f7;
      margin: 0;
      padding: 24px;
    }

    .card {
      max-width: 720px;
      margin: 0 auto 24px;
      background: #fff;
      padding: 24px;
      border-radius: 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    }

    h2 {
      margin: 0 0 12px;
    }

    .hint {
      font-size: 14px;
      color: #666;
      margin-bottom: 16px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    label {
      font-weight: 600;
      display: block;
      margin-bottom: 6px;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .full {
      grid-column: 1 / -1;
    }

    button {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      background: #06c755;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
    }

    button:disabled {
      background: #a5d6b3;
      cursor: not-allowed;
    }

    .status {
      margin-top: 12px;
      font-size: 14px;
      text-align: center;
    }

    @media (max-width: 640px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>

  <!-- =========================
       ğŸ“Œ åŸºæœ¬è³‡æ–™
  ========================= -->
  <div class="card">
    <h2>ğŸ“Œ PICC æ–½æ‰“å›å ±ï¼ˆè‡ªèµ·å–®ãƒ»è‡ªå›å ±ï¼‰</h2>
    <div class="hint">
      æœ¬è¡¨å–®ç”¨æ–¼ã€Œè‡ªè¡Œæ–½æ‰“ä¸¦ç«‹å³å›å ±ã€ï¼Œé€å‡ºå¾Œå³è¦–ç‚ºå®Œæˆã€‚
    </div>

    <div class="grid">
      <div>
        <label>ç—…äººå§“å</label>
        <input id="name" placeholder="ä¾‹å¦‚ï¼šç‹å¤§æ˜" />
      </div>

      <div>
        <label>åºŠè™Ÿ</label>
        <input id="bedNo" placeholder="ä¾‹å¦‚ï¼š10906" />
      </div>

      <div>
        <label>MRN</label>
        <input id="mrn" placeholder="ä¾‹å¦‚ï¼š12345678" />
      </div>

      <div>
        <label>æ–½æ‰“äºº</label>
        <input id="operator" placeholder="ä½ çš„å§“å" />
      </div>
    </div>
  </div>

  <!-- =========================
       ğŸ§¾ æ–½æ‰“å›å ±è³‡æ–™
  ========================= -->
  <div class="card">
    <h2>ğŸ§¾ æ–½æ‰“å›å ±è³‡æ–™</h2>

    <div class="grid">
      <div>
        <label>æ”¾ç½®å›°é›£åº¦</label>
        <select id="difficulty">
          <option value="">è«‹é¸æ“‡</option>
          <option value="éå¸¸ç°¡å–®">éå¸¸ç°¡å–®</option>
          <option value="ç°¡å–®">ç°¡å–®</option>
          <option value="ä¸­ç­‰">ä¸­ç­‰</option>
          <option value="å›°é›£">å›°é›£</option>
          <option value="éå¸¸å›°é›£">éå¸¸å›°é›£</option>
        </select>
      </div>

      <div>
        <label>æ–½æ‰“ä½ç½®</label>
        <select id="insertionSite">
          <option value="">è«‹é¸æ“‡</option>
          <option value="å³ä¸Šè‡‚">å³ä¸Šè‡‚</option>
          <option value="å·¦ä¸Šè‡‚">å·¦ä¸Šè‡‚</option>
        </select>
      </div>

      <div>
        <label>è¡€ç®¡</label>
        <select id="vein">
          <option value="">è«‹é¸æ“‡</option>
          <option value="Basilic">Basilic</option>
          <option value="Cephalic">Cephalic</option>
          <option value="Brachial">Brachial</option>
        </select>
      </div>

      <div>
        <label>ç®¡è·¯é¡å‹</label>
        <select id="catheterType">
          <option value="">è«‹é¸æ“‡</option>
          <option value="é›™è…”">é›™è…”</option>
          <option value="å–®è…”">å–®è…”</option>
        </select>
      </div>

      <div>
        <label>ç®¡è·¯é•·åº¦ï¼ˆcmï¼‰</label>
        <input id="catheterLength" type="number" />
      </div>

      <div class="full">
        <label>å‚™è¨»</label>
        <textarea id="remark" placeholder="è£œå……èªªæ˜ï¼ˆå¯ä¸å¡«ï¼‰"></textarea>
      </div>
    </div>

    <button id="submitBtn" onclick="submitReport()">é€å‡ºæ–½æ‰“å›å ±</button>
    <div class="status" id="statusText"></div>
  </div>

  <script>
    /***********************
     * ğŸ”§ n8n Webhook
     ***********************/
    const WEBHOOK_URL = "https://ä½ çš„-n8n-domain/webhook/picc-self-report";

    async function submitReport() {
      const btn = document.getElementById("submitBtn");
      const status = document.getElementById("statusText");

      const payload = {
        name: name.value.trim(),
        bedNo: bedNo.value.trim(),
        mrn: mrn.value.trim(),
        operator: operator.value.trim(),
        difficulty: difficulty.value,
        insertionSite: insertionSite.value,
        vein: vein.value,
        catheterType: catheterType.value,
        catheterLength: catheterLength.value,
        remark: remark.value.trim(),
        source: "self-report",
        status: "å®Œæˆ",
        createdAt: new Date().toISOString(),
        completedAt: new Date().toISOString()
      };

      if (!payload.name || !payload.mrn || !payload.operator) {
        alert("è«‹è‡³å°‘å¡«å¯« ç—…äººå§“å / MRN / æ–½æ‰“äºº");
        return;
      }

      btn.disabled = true;
      btn.innerText = "é€å‡ºä¸­â€¦";
      status.innerText = "é€å‡ºä¸­â€¦";

      try {
        const res = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error("Webhook error");

        status.innerText = "âœ… å·²å®Œæˆæ–½æ‰“å›å ±";
        btn.innerText = "å·²é€å‡º";
      } catch (e) {
        console.error(e);
        status.innerText = "âŒ é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";
        btn.disabled = false;
        btn.innerText = "é€å‡ºæ–½æ‰“å›å ±";
      }
    }
  </script>

</body>
</html>
